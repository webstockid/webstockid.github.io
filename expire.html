<?xml version="1.0" encoding="utf-8"?>
<html xmlns="http://www.w3.org/1999/xhtml">
<!DOCTYPE html PUBLIC '-//WAPFORUM//DTD XHTML Mobile 1.0//EN' 'http://www.wapforum.org/DTD/xhtml-mobile10.dtd'>
	<head>
		<title>Masa Aktif Member</title>
		<meta charset="UTF-8">
		<meta name="author" content="Hardiansyah">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, minimal-scale=1.0, maximal-scale=1">
		<!-- <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css"> -->
		<link rel="manifest" href="manifest.json">
		<link rel="stylesheet" href="stockid_script/exp.css">
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link href="https://fonts.googleapis.com/css2?family=Fredoka&display=swap" rel="stylesheet">
		<meta property="og:title" content="Di Tinggal Kekasih Emang Menyakitkan üíî">
		<meta property="og:description" content="Tapi Pernah Gak Sih Loe Di Tinggal Stock ID VIP? üóø">
		<meta name="theme-color" content="#3498db">
		<meta property="og:image" content="stockid_gambar/thumb.jpg">
		<meta property="og:url" content="https://webstockid.github.io/exp">
		<meta property="og:type" content="website">
	</head>
	
	<body>
	<h2>Monitoring Masa Aktif Member</h2>
	
	<div class="stat-box" id="statistik"></div>
	<div class="controls">
		<input id="search" placeholder="Cari nama kamu...">
		<select id="filter">
			<option value="all">Semua</option>
			<option value="1">1 Bulan</option>
			<option value="2">2 Bulan</option>
			<option value="3">3 Bulan</option>
			<option value="6">6 Bulan</option>
			<option value="12">1 Tahun</option>
			<option value="expired">Expired</option>
		</select>
	</div>
	
	<button onclick="enableNotif()" class="notif-btn">
		üîî Aktifkan Reminder
	</button>
	<audio id="notifSound" src="stockid_suara/notif.mp3"></audio>
	<br><br>
	
	<div id="list"></div>

	<script>
	/* ================= DATA MEMBER ================= */
	const members = [
		{ nama:"Mas. Yayat", wa:"82967078794", expired:"2027-02-21", history:[12] },
		{ nama:"Mas. Dimas", wa:"6282288133212", expired:"2027-02-11", history:[1,12] },
		{ nama:"Mas. Devan", wa:"6285800322160", expired:"2026-09-18", history:[1,6] },
		{ nama:"Mas. Ardha", wa:"6281542779853", expired:"2026-08-25", history:[3,6] },
		{ nama:"Mas. Vani", wa:"6289662208826", expired:"2026-08-09", history:[6] },
		{ nama:"Mas. Tito", wa:"6281270370727", expired:"2026-06-30", history:[3,3] },
		{ nama:"Mas. Farhan", wa:"6288221513462", expired:"2026-06-22", history:[1,3] },
		{ nama:"Mas. Yoga", wa:"6282382795953", expired:"2026-06-18", history:[3,3] },
		{ nama:"Mas. Dika", wa:"628131093311", expired:"2026-06-02", history:[3] },
		{ nama:"Mas. Adam", wa:"6282140581317", expired:"2026-05-26", history:[3] },
		{ nama:"Mas. Tomy", wa:"6289609809039", expired:"2026-05-22", history:[1,2,2] },
		{ nama:"Mas. Dedi", wa:"6285951568082", expired:"2026-05-21", history:[1,3] },
		{ nama:"Mas. Arif", wa:"6285265337779", expired:"2026-05-16", history:[1,3] },
		{ nama:"Mas. Ananda", wa:"6282256863256", expired:"2026-05-12", history:[3] },
		{ nama:"Mas. Anggoro", wa:"6289525567420", expired:"2026-05-10", history:[3] },
		{ nama:"Mba. Puspita", wa:"6282146281427", expired:"2026-05-10", history:[3] },
		{ nama:"Mas. Faisal", wa:"6285727473240", expired:"2026-05-07", history:[1,2] },
		{ nama:"Mas. Abdul", wa:"6285704755602", expired:"2026-05-06", history:[1,2] },
		{ nama:"Mba. Fauziah", wa:"6285753648079", expired:"2026-05-05", history:[1,2] },
		{ nama:"Mas. Ardan", wa:"628888136363", expired:"2026-04-28", history:[2] },
		{ nama:"Mas. Dwiky", wa:"628116383088", expired:"2026-04-27", history:[1,1,2] },
		{ nama:"Mas. Ihsan", wa:"6282215352174", expired:"2026-04-27", history:[2] },
		{ nama:"Mba. Dhila", wa:"6289528936511", expired:"2026-04-26", history:[1,1] },
		{ nama:"Mas. Roid", wa:"6287819304040", expired:"2026-04-25", history:[1,2] },
		{ nama:"Mas. Made", wa:"6281353043869", expired:"2026-02-05", history:[1,2] }
	];
	
	const DAY=86400000,HOUR=3600000,MIN=60000;
	const lastMonth=m=>m.history.at(-1)||0;
	const target=d=>new Date(d+"T00:00:00").getTime();
	
	/* ================= FORMAT ================= */
	function sisa(ms) {
		if (ms<=0) return "Expired";
		const h=Math.floor(ms/DAY);
		const j=Math.floor(ms%DAY/HOUR);
		const m=Math.floor(ms%HOUR/MIN);
		return `${h} Hari ${j} Jam ${m} Menit`;
	}
	
	function kelas(b,ms) {
		if (ms<=0) return "expired";
		if (b==1) return "satu";
		if (b==2) return "dua";
		if (b==3) return "tiga";
		if (b==6) return "enam";
		if (b==12) return "setahun";
	}
	
	function badge(arr) {
		if (arr.length==1) return `+${arr[0]} bulan`;
		return `+${arr.slice(0,-1).join(", ")} & ${arr.at(-1)} bulan`;
	}
	
	function join(arr) {
		return arr.map(b=>`${b} Bulan`).join(" + ");
	}
	
	/* ================= STAT ================= */
	function renderStat(data) {
		const box=document.getElementById("statistik");
		box.innerHTML="";
		const map={1:0,2:0,3:0,6:0,12:0,x:0};
		data.forEach(m=> {
			if (m.ms<=0) map.x++;
			else map[lastMonth(m)]++;
		});
		
		const rows=[
			[1,"1 Bulan","b1"],
			[2,"2 Bulan","b2"],
			[3,"3 Bulan","b3"],
			[6,"6 Bulan","b6"],
			[12,"1 Tahun","b12"],
			["x","Expired","bx"]
		];
		
		const max=Math.max(...Object.values(map),1);
		
		rows.forEach(r=> {
			const val=map[r[0]];
			const el=document.createElement("div");
			el.className="stat-row";
			el.innerHTML=`
			<div class="stat-label">${r[1]} (${val})</div>
			<div class="bar">
			<div class="bar-fill ${r[2]}" style="--w:${val/max*30}%"></div>
			</div>`;
			box.appendChild(el);
		});
	}
	
	/* ================= RENDER ================= */
	function render() {
		const list=document.getElementById("list");
		list.innerHTML="";
		const key=search.value.toLowerCase();
		const f=filter.value;
		members.forEach(m=>m.ms=target(m.expired)-Date.now());
		const sorted=[...members].sort((a,b)=>b.ms-a.ms);
		renderStat(sorted);
		sorted.forEach(m=> {
			const lm=lastMonth(m);
			if (!m.nama.toLowerCase().includes(key)) return;
			if (f==="expired" && m.ms>0) return;
			if (f!=="all" && f!=="expired" && lm!=f) return;
			const div=document.createElement("div");
			div.className="member "+kelas(lm,m.ms);
			div.innerHTML=`
			<b>Nama: ${m.nama}</b><br>
			Expired: ${m.expired}<br>
			Sisa Waktu: ${sisa(m.ms)}
			<span class="badge">${badge(m.history)}</span>
			<div class="history">Join Kelas: ${join(m.history)}</div>
			`;
			list.appendChild(div);
		});
		if(w){
  const key=notifKey(m,w);
  if(!localStorage.getItem(key)){
    let title="‚è∞ Masa Aktif Member";
    let msg="";
    if(w=="h7") msg=`${m.nama} akan expired 7 hari lagi`;
    if(w=="h3") msg=`${m.nama} tinggal 3 hari lagi`;
    if(w=="expired") msg=`${m.nama} sudah EXPIRED`;
    pushNotif(title,msg);
    localStorage.setItem(key,"1");
  }
}

	}
	
	search.oninput=render;
	filter.onchange=render;
	setInterval(render,10000); //6000
	render();
	</script>
	
	<script>
	if('serviceWorker' in navigator){
  navigator.serviceWorker.register('/sw.js').then(reg=>{
    console.log("Service Worker Registered", reg);
  }).catch(err=>{
    console.log("SW Registration failed: ", err);
  });

  navigator.serviceWorker.addEventListener('message', e=>{
    if(e.data.type === 'check-reminder'){
      render(); // trigger reminder H-7, H-3, Expired
    }
  });
}
</script>

	<script>
		function enableNotif(){
  if(!("Notification" in window)){
    alert("Browser tidak mendukung notifikasi");
    return;
  }
  Notification.requestPermission().then(p=>{
    if(p==="granted") alert("Notifikasi diaktifkan ‚úÖ");
  });
}

function pushNotif(title, body){
  if(Notification.permission!=="granted") return;
  new Notification(title,{body:body,icon:"stockid_gambar/alert.jpg",vibrate:[200,100,200]});
  document.getElementById("notifSound").play().catch(()=>{});
}
</script>
	
	</body>
</html>
